\documentclass[a4paper, 12pt]{article} %размер бумаги устанавливаем А4, шрифт 15пунктов
\usepackage[margin=0.5in]{geometry}
% \usepackage[a4paper, total={6in, 8in}]{geometry}
\usepackage[utf8]{inputenc}%кодировка
\usepackage[russian]{babel}%используем русский и английский языки с переносами
% \graphicspath{{/}}%путь к рисункам
\usepackage{cite}
\usepackage{multirow}
\usepackage{float}
\usepackage{tikz}
\usetikzlibrary{arrows}
\usepackage{ amssymb }
\usepackage{ amsmath}
\usepackage{listings}
\usepackage{xcolor}
\graphicspath{{pictures/}}
\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{dred}{rgb}{0.545,0,0}
\definecolor{dblue}{rgb}{0,0,0.545}
\definecolor{lgrey}{rgb}{0.9,0.9,0.9}
\definecolor{gray}{rgb}{0.4,0.4,0.4}
\definecolor{darkblue}{rgb}{0.0,0.0,0.6}

\usepackage{minted}

\usepackage[labelformat=empty]{caption}
\usepackage{fontspec}
\usepackage{polyglossia}
\setdefaultlanguage{russian}
\defaultfontfeatures{Ligatures=TeX}
\setmainfont{CMU Serif}
\setsansfont{CMU Sans Serif}
\setmonofont{CMU Typewriter Text}

\usepackage{tikz}
\newcommand{\tikzmark}[3][]{\tikz[remember picture,baseline] \node [inner xsep=0pt,anchor=base,#1](#2) {#3};}
\usepackage{lscape}
\usepackage{pdflscape}

\lstset{
  frame=none,
  xleftmargin=2pt,
  stepnumber=1,
  numbers=left,
  numbersep=5pt,
  numberstyle=\ttfamily\tiny\color[gray]{0.3},
  belowcaptionskip=\bigskipamount,
  captionpos=b,
  escapeinside={*'}{'*},
  language=haskell,
  tabsize=2,
  emphstyle={\bf},
  commentstyle=\it,
  stringstyle=\mdseries\rmfamily,
  showspaces=false,
  keywordstyle=\bfseries\rmfamily,
  columns=flexible,
  basicstyle=\small\sffamily,
  showstringspaces=false,
  morecomment=[l]\%,
}

\begin{document}
\section{Algorithm constrcuting traversal for untyped lambda calculus}
Algorithm constructs a traversal for arbitrary untyped lambda expression \textbf{M}.\\
Syntax for input lambda term:\\
$\Lambda\ ::=\ \lambda x . \Lambda\ |\ \Lambda\ @\ \Lambda\ |\ x$

Let \textit{traversal} be a 
justified sequence of \textit{tokens} (i.e. \textbf{M} subexpressions) with several backpointers.

Current algorithm version uses 4 different kinds of backpointers:
\begin{enumerate}
\item \textit{bp1\_} --- doesn't used for constructing traversal at all, it is \textbf{only} used for reconstructing the output term from the traversal has being generated; (this pointer is omitted in this notes)
\item \textit{bp2\_} --- a pointer to the last unfinished application (i.e. application that left-hand side is already traversed or is under consideration at the moment but its left-hand side haven't been considered yet);
\item \textit{bp3\_} --- pointer that bounds (Lam)-s with their arguments;\\
for examples: $(\lambda x . \lambda y . \cdots)\ @_1\ M_1)\ @_2\ M_2$\\will generate the following traversal (all other backpointers are omitted)
\[\tikzmark{1}{$@_2$}\ \ \tikzmark{2}{$@_1$}\ \ \tikzmark{3}{$\lambda x$}\ \ \tikzmark{4}{$\lambda y$}\ \ \dots \]
\begin{tikzpicture}[remember picture,overlay]
  \color{red}{\draw[->] (3.north) to[bend right] (2.north);}
  \color{red}{\draw[->] (4.north) to[bend right] (1.north);}
\end{tikzpicture}
\textbf{NB}: not only (Lam)-s could have \textit{bp2\_} pointer; other tokens also have this pointer but with only one purpuse: support o finding corresponding pointers fot (Lam)-s;
\item \textit{bp4\_} --- a binder pointer; \textit{Invariant}: from each (BVar) token "x" it points to its correct dynamic binder (Lam) "$\lambda x . \cdots$"
\end{enumerate}

\textbf{Comments:}
\begin{itemize}
\item also each traversal element have a boolean flag; (if it is setted that means that in this point head linear reduction got stuck and we started to look for the latest unfinished application);
\item there is no difference between a free variable case and a bound variable case whose binder(lambda) is not "applied";
\item pointers \textit{bp2\_} and \textit{bp3\_} are \textbf{very similar} but still different;
\end{itemize}

\section*{Rules for construction traversal and backpointers}
On each step algorithm extends a current traversal \textit{tr} by adding new justified token.\\
Let \textit{x} denotes the last element of \textit{tr},\\
\textit{tr = n:t},\\
bp\textit{i}\_x denotes the i-th pointer of token \textit{x}.

\textbf{Pseudo-code:}
\begin{minted}{haskell}
input: tr@((x, b_x, bp2_x bp3_x, bp4_x):t)
case x of
  
  (App): e _    ||   (Abs): \ _ . e
    -> (e, False, findLastUnapplied, findLastUnapplied, computeBI e |tr|):tr

  (BVar): z
    if exists a bound argument (e, i)
    | Invariants:
    |   e --- term to be substituted instead of variable z
    |   i --- an application location in traversal (e is a child of this application)
    | Finding bound argument:
    |   1) make a step through bp4_x (Invariant: we reach a binder)
    |   2) if bp3_binder == 0
    |      then Nothing
    |      else make a step through bp3_binder (Invariant: we reach an (App): _ e2)
    |           return Just (e2, bp3_binder)
    then (e, False, findLastUnapplied, findLastUnapplied, computeBI e i):tr
    else GOTO_(FVar)

  (FVar): z
    if exists (the latest one) unfinished application (e, i)
    | Invariants:
    |   e --- argument of the LUA
    |   i --- pointer to the "new" LUA
    | Finding unfinished application:
    |   if bp2_x == 0
    |   then Nothing
    |   else make a step through bp2_x (Invariant: we reach an (App): _ e2)
    |        return Just (e2, bp2_app)
    then if e == (Abs)
    | then (e, False, bp2\_x, 0, computeBI tr e bp2_x):(x, True, bp2_x bp3_x, bp4_x):t
    | else (e, False, i     , 0, computeBI tr e bp2_x):(x, True, bp2_x bp3_x, bp4_x):t
    else END_OF_TRAVERSAL
\end{minted}

\subsection*{Auxiliary functions}
\begin{minted}{haskell}
-- function findLastUnapplied by traversal returns a last "unapplied" application
-- (i.e. such that there is not (Lam) that points to that application)
findLastUnapplied empty_traversal = 0
findLastUnapplied tr@((Abs _, _, _, 0    , _, _):xs) = 0     -- i.e. bp2_ == 0
findLastUnapplied tr@((Abs _, _, _, bp2_x, _, _):xs) =
  let tr'@((_, _, _, bp2', _, _):_) = drop (|tr| - bp2_x) tr -- go throught bp2_
  in findLastUnapplied (drop (bp2_x - bp2') tr')             -- go throught bp2_ 
                                                             -- again and rec call
findLastUnapplied tr@((ULApp _):xs) = |tr|
findLastUnapplied tr@((ULVar _ , _, _, bp2_x, _):xs) =
  findLastUnapplied (drop (|tr| - bp2_x) tr)                 -- go throught bp2_ again
                                                             -- and rec call

computeBI e i = case e of
  (BVar)    -> findDynamicBinder z (drop (|tr| - i) tr)      -- drop extra elements and
                                                             -- find binder
                                                             -- to find dynamic binder
                                                             -- strongly follow bp4_ till
                                                             -- reach binder
  (FVar)    -> 0
  otherwise -> i
\end{minted}

\begin{landscape}

\section{Examples}
Backpointers colors: {\color{red}{bp2}} --- red; {\color{blue}{bp3}} --- blue; {\color{green}{bp4}} --- green;\\
{\color{blue}{Blue tokens}} --- (FVar) or (BVar) where head linear reduction got a stuck, thus, finding unfinished application was called.

\subsection{mult three two}
$three\ =\ \lambda a . \lambda q . a @_6 (a @_7 (a @_8 q))$\\
$two\ \ \ =\ \lambda d . \lambda e . d @_9 (d @_10 e)$\\
$mult\ =\ \lambda m . \lambda n . \lambda s . \lambda z . (m @_4 (n @_5 s)) @_3 z$\\
$mult\_3\_2 = (mult @_2 three) @_1 two$\\
\textbf{NB}: in this example there is no difference between bp3\_ and bp2\_, thus, bp\_3 is omitted
\begin{enumerate}
\item
\[\tikzmark{1}{$@_1$}\]
\item
\[\tikzmark{1}{$@_1$}\ \ \tikzmark{2}{$@_2$}\]
\begin{tikzpicture}[remember picture,overlay]
  \color{red}{\draw[->] (2.north) to[bend right] (1.north);}
  \color{green}{\draw[->] (2.south) to[bend left] (1.south);}
\end{tikzpicture}
\item
\[\tikzmark{1}{$@_1$}\ \ \tikzmark{2}{$@_2$}\ \ \tikzmark{3}{$\lambda m$}\]
\begin{tikzpicture}[remember picture,overlay]
  \color{red}{\draw[->] (2.north) to[bend right] (1.north);}
  \color{green}{\draw[->] (2.south) to[bend left] (1.south);}
  \color{red}{\draw[->] (3.north) to[bend right] (2.north);}
  \color{green}{\draw[->] (3.south) to[bend left] (2.south);}
\end{tikzpicture}
\item
\[\tikzmark{1}{$@_1$}\ \ \tikzmark{2}{$@_2$}\ \ \tikzmark{3}{$\lambda m$}\ \ \tikzmark{4}{$\lambda n$}\]
\begin{tikzpicture}[remember picture,overlay]
  \color{red}{\draw[->] (2.north) to[bend right] (1.north);}
  \color{green}{\draw[->] (2.south) to[bend left] (1.south);}
  \color{red}{\draw[->] (3.north) to[bend right] (2.north);}
  \color{green}{\draw[->] (3.south) to[bend left] (2.south);}
  \color{red}{\draw[->] (4.north) to[bend right] (1.north);}
  \color{green}{\draw[->] (4.south) to[bend left] (3.south);}
\end{tikzpicture}
\item
\[\tikzmark{1}{$@_1$}\ \ \tikzmark{2}{$@_2$}\ \ \tikzmark{3}{$\lambda m$}\ \ \tikzmark{4}{$\lambda n$}\ \ \tikzmark{5}{$\lambda s$}\]
\begin{tikzpicture}[remember picture,overlay]
  \color{red}{\draw[->] (2.north) to[bend right] (1.north);}
  \color{green}{\draw[->] (2.south) to[bend left] (1.south);}
  \color{red}{\draw[->] (3.north) to[bend right] (2.north);}
  \color{green}{\draw[->] (3.south) to[bend left] (2.south);}
  \color{red}{\draw[->] (4.north) to[bend right] (1.north);}
  \color{green}{\draw[->] (4.south) to[bend left] (3.south);}
  \color{green}{\draw[->] (5.south) to[bend left] (4.south);}
\end{tikzpicture}
\item
\[\tikzmark{1}{$@_1$}\ \ \tikzmark{2}{$@_2$}\ \ \tikzmark{3}{$\lambda m$}\ \ \tikzmark{4}{$\lambda n$}\ \ \tikzmark{5}{$\lambda s$}\ \ \tikzmark{6}{$\lambda z$}\]
\begin{tikzpicture}[remember picture,overlay]
  \color{red}{\draw[->] (2.north) to[bend right] (1.north);}
  \color{green}{\draw[->] (2.south) to[bend left] (1.south);}
  \color{red}{\draw[->] (3.north) to[bend right] (2.north);}
  \color{green}{\draw[->] (3.south) to[bend left] (2.south);}
  \color{red}{\draw[->] (4.north) to[bend right] (1.north);}
  \color{green}{\draw[->] (4.south) to[bend left] (3.south);}
  \color{green}{\draw[->] (5.south) to[bend left] (4.south);}
  \color{green}{\draw[->] (6.south) to[bend left] (5.south);}
\end{tikzpicture}
\item
\[\tikzmark{1}{$@_1$}\ \ \tikzmark{2}{$@_2$}\ \ \tikzmark{3}{$\lambda m$}\ \ \tikzmark{4}{$\lambda n$}\ \ \tikzmark{5}{$\lambda s$}\ \ \tikzmark{6}{$\lambda z$}\ \ \tikzmark{7}{$@_3$}\]
\begin{tikzpicture}[remember picture,overlay]
  \color{red}{\draw[->] (2.north) to[bend right] (1.north);}
  \color{green}{\draw[->] (2.south) to[bend left] (1.south);}
  \color{red}{\draw[->] (3.north) to[bend right] (2.north);}
  \color{green}{\draw[->] (3.south) to[bend left] (2.south);}
  \color{red}{\draw[->] (4.north) to[bend right] (1.north);}
  \color{green}{\draw[->] (4.south) to[bend left] (3.south);}
  \color{green}{\draw[->] (5.south) to[bend left] (4.south);}
  \color{green}{\draw[->] (6.south) to[bend left] (5.south);}
  \color{green}{\draw[->] (7.south) to[bend left] (6.south);}
\end{tikzpicture}
\item
\[\tikzmark{1}{$@_1$}\ \ \tikzmark{2}{$@_2$}\ \ \tikzmark{3}{$\lambda m$}\ \ \tikzmark{4}{$\lambda n$}\ \ \tikzmark{5}{$\lambda s$}\ \ \tikzmark{6}{$\lambda z$}\ \ \tikzmark{7}{$@_3$}\ \ \tikzmark{8}{$@_4$}\]
\begin{tikzpicture}[remember picture,overlay]
  \color{red}{\draw[->] (2.north) to[bend right] (1.north);}
  \color{green}{\draw[->] (2.south) to[bend left] (1.south);}
  \color{red}{\draw[->] (3.north) to[bend right] (2.north);}
  \color{green}{\draw[->] (3.south) to[bend left] (2.south);}
  \color{red}{\draw[->] (4.north) to[bend right] (1.north);}
  \color{green}{\draw[->] (4.south) to[bend left] (3.south);}
  \color{green}{\draw[->] (5.south) to[bend left] (4.south);}
  \color{green}{\draw[->] (6.south) to[bend left] (5.south);}
  \color{green}{\draw[->] (7.south) to[bend left] (6.south);}
  \color{red}{\draw[->] (8.north) to[bend right] (7.north);}
  \color{green}{\draw[->] (8.south) to[bend left] (7.south);}
\end{tikzpicture}
\item $\cdots$
\item
\[\tikzmark{1}{$@_1$}\ \tikzmark{2}{$@_2$}\ \tikzmark{3}{$\lambda m$}\ \tikzmark{4}{$\lambda n$}\ \tikzmark{5}{$\lambda s$}\ \tikzmark{6}{$\lambda z$}\ \tikzmark{7}{$@_3$}\ \tikzmark{8}{$@_4$}\ \tikzmark{9}{$m$}\ \tikzmark{10}{$\lambda a$}\ \tikzmark{11}{$\lambda q$}\ \tikzmark{12}{$@_6$}\ \tikzmark{13}{$a$}\ \tikzmark{14}{$@_5$}\ \tikzmark{15}{$n$}\ \tikzmark{16}{$\lambda d$}\ \tikzmark{17}{$\lambda e$}\ \tikzmark{18}{$@_9$}\ \tikzmark{19}{$d$}\ \color{blue}{\tikzmark{20}{$s$}}\ \color{black}{\tikzmark{21}{$@_{10}$}}\ \tikzmark{22}{$d$}\ \color{blue}{\tikzmark{23}{$s$}}\ \color{black}{\tikzmark{24}{$e$}}\ \tikzmark{25}{$@_7$}\ \tikzmark{26}{$a$}\ \tikzmark{27}{$@_5$}\ \tikzmark{28}{$n$}\ \tikzmark{29}{$\lambda d$}\ \tikzmark{30}{$\lambda e$}\ \tikzmark{31}{$@_9$}\ \tikzmark{32}{$d$}\ \color{blue}{\tikzmark{33}{$s$}}\ \color{black}{\tikzmark{34}{$@_{10}$}}\ \tikzmark{35}{$d$}\ \color{blue}{\tikzmark{36}{$s$}}\ \color{black}{\tikzmark{37}{$e$}}\ \tikzmark{38}{$@_8$}\ \tikzmark{39}{$a$}\ \tikzmark{40}{$@_5$}\ \tikzmark{41}{$n$}\ \tikzmark{42}{$\lambda d$}\ \tikzmark{43}{$\lambda e$}\ \tikzmark{44}{$@_9$}\ \tikzmark{45}{$d$}\ \color{blue}{\tikzmark{46}{$s$}}\ \color{black}{\tikzmark{47}{$@_{10}$}}\ \tikzmark{48}{$d$}\ \color{blue}{\tikzmark{49}{$s$}}\ \color{black}{\tikzmark{50}{$e$}}\ \tikzmark{51}{$q$}\ \color{blue}{\tikzmark{52}{$z$}}\]
\begin{tikzpicture}[remember picture,overlay]
  \color{red}{\draw[->] (2.north) to[bend right] (1.north);}
  \color{green}{\draw[->] (2.south) to[bend left] (1.south);}
  \color{red}{\draw[->] (3.north) to[bend right] (2.north);}
  \color{green}{\draw[->] (3.south) to[bend left] (2.south);}
  \color{red}{\draw[->] (4.north) to[bend right] (1.north);}
  \color{green}{\draw[->] (4.south) to[bend left] (3.south);}
  \color{green}{\draw[->] (5.south) to[bend left] (4.south);}
  \color{green}{\draw[->] (6.south) to[bend left] (5.south);}
  \color{green}{\draw[->] (7.south) to[bend left] (6.south);}
  \color{red}{\draw[->] (8.north) to[bend right] (7.north);}
  \color{green}{\draw[->] (8.south) to[bend left] (7.south);}
  \color{red}{\draw[->] (9.north) to[bend right] (8.north);}
  \color{green}{\draw[->] (9.south) to[bend left] (3.south);}
  \color{red}{\draw[->] (10.north) to[bend right] (8.north);}
  \color{green}{\draw[->] (10.south) to[bend left] (2.south);}
  \color{red}{\draw[->] (11.north) to[bend right] (7.north);}
  \color{green}{\draw[->] (11.south) to[bend left] (10.south);}
  \color{green}{\draw[->] (12.south) to[bend left] (11.south);}
  \color{red}{\draw[->] (13.north) to[bend right] (12.north);}
  \color{green}{\draw[->] (13.south) to[bend left] (10.south);}
  \color{red}{\draw[->] (14.north) to[bend right] (12.north);}
  \color{green}{\draw[->] (14.south) to[bend left] (8.south);}
  \color{red}{\draw[->] (15.north) to[bend right] (14.north);}
  \color{green}{\draw[->] (15.south) to[bend left] (4.south);}
  \color{red}{\draw[->] (16.north) to[bend right] (14.north);}
  \color{green}{\draw[->] (16.south) to[bend left] (1.south);}
  \color{red}{\draw[->] (17.north) to[bend right] (12.north);}
  \color{green}{\draw[->] (17.south) to[bend left] (16.south);}
  \color{green}{\draw[->] (18.south) to[bend left] (17.south);}
  \color{red}{\draw[->] (19.north) to[bend right] (18.north);}
  \color{green}{\draw[->] (19.south) to[bend left] (16.south);}
  \color{red}{\draw[->] (20.north) to[bend right] (18.north);}
  \color{green}{\draw[->] (20.south) to[bend left] (5.south);}
  \color{green}{\draw[->] (21.south) to[bend left] (18.south);}
  \color{red}{\draw[->] (22.north) to[bend right] (21.north);}
  \color{green}{\draw[->] (22.south) to[bend left] (16.south);}
  \color{red}{\draw[->] (23.north) to[bend right] (21.north);}
  \color{green}{\draw[->] (23.south) to[bend left] (5.south);}
  \color{green}{\draw[->] (24.south) to[bend left] (17.south);}
  \color{green}{\draw[->] (25.south) to[bend left] (12.south);}
  \color{red}{\draw[->] (26.north) to[bend right] (25.north);}
  \color{green}{\draw[->] (26.south) to[bend left] (10.south);}
  \color{red}{\draw[->] (27.north) to[bend right] (25.north);}
  \color{green}{\draw[->] (27.south) to[bend left] (8.south);}
  \color{red}{\draw[->] (28.north) to[bend right] (27.north);}
  \color{green}{\draw[->] (28.south) to[bend left] (4.south);}
  \color{red}{\draw[->] (29.north) to[bend right] (27.north);}
  \color{green}{\draw[->] (29.south) to[bend left] (1.south);}
  \color{red}{\draw[->] (30.north) to[bend right] (25.north);}
  \color{green}{\draw[->] (30.south) to[bend left] (29.south);}
  \color{green}{\draw[->] (31.south) to[bend left] (30.south);}
  \color{red}{\draw[->] (32.north) to[bend right] (31.north);}
  \color{green}{\draw[->] (32.south) to[bend left] (29.south);}
  \color{red}{\draw[->] (33.north) to[bend right] (31.north);}
  \color{green}{\draw[->] (33.south) to[bend left] (5.south);}
  \color{green}{\draw[->] (34.south) to[bend left] (31.south);}
  \color{red}{\draw[->] (35.north) to[bend right] (34.north);}
  \color{green}{\draw[->] (35.south) to[bend left] (29.south);}
  \color{red}{\draw[->] (36.north) to[bend right] (34.north);}
  \color{green}{\draw[->] (36.south) to[bend left] (30.south);}
  \color{green}{\draw[->] (37.south) to[bend left] (30.south);}
  \color{green}{\draw[->] (38.south) to[bend left] (25.south);}
  \color{red}{\draw[->] (39.north) to[bend right] (38.north);}
  \color{green}{\draw[->] (39.south) to[bend left] (10.south);}
  \color{red}{\draw[->] (40.north) to[bend right] (38.north);}
  \color{green}{\draw[->] (40.south) to[bend left] (8.south);}
  \color{red}{\draw[->] (41.north) to[bend right] (40.north);}
  \color{green}{\draw[->] (41.south) to[bend left] (4.south);}
  \color{red}{\draw[->] (42.north) to[bend right] (40.north);}
  \color{green}{\draw[->] (42.south) to[bend left] (1.south);}
  \color{red}{\draw[->] (43.north) to[bend right] (38.north);}
  \color{green}{\draw[->] (43.south) to[bend left] (42.south);}
  \color{green}{\draw[->] (44.south) to[bend left] (43.south);}
  \color{red}{\draw[->] (45.north) to[bend right] (44.north);}
  \color{green}{\draw[->] (45.south) to[bend left] (42.south);}
  \color{red}{\draw[->] (46.north) to[bend right] (44.north);}
  \color{green}{\draw[->] (46.south) to[bend left] (5.south);}
  \color{green}{\draw[->] (47.south) to[bend left] (44.south);}
  \color{red}{\draw[->] (48.north) to[bend right] (47.north);}
  \color{green}{\draw[->] (48.south) to[bend left] (42.south);}
  \color{red}{\draw[->] (49.north) to[bend right] (47.north);}
  \color{green}{\draw[->] (49.south) to[bend left] (5.south);}
  \color{green}{\draw[->] (50.south) to[bend left] (43.south);}
  \color{green}{\draw[->] (51.south) to[bend left] (11.south);}
  \color{green}{\draw[->] (52.south) to[bend left] (6.south);}
\end{tikzpicture}
\\ \\ \\ \\ \\ \\ 
\end{enumerate}



\subsection{NPR example}
$R \ = \ g\ @_{11}\ (\lambda n . n)$\\
$P \ = \ \lambda f . \lambda y . f @_7 ((g @_8 (\lambda b . b)) @_9 y)$\\
$N \ = \ \lambda h . \lambda z . ((h @_1 (\lambda x . ((h @_2 (\lambda q . x)) @_3 a))) @_4 (z @_5 a))$\\
$ex \ = \ (N @_6 P) @_{10} Q$\\
\textbf{NB}: tokens with different bp2\_ and bp3\_ are {\color{violet}{colored}}.

\[\tikzmark{1}{$@_{10}$}\ \ \tikzmark{2}{$@_6$}\ \ \tikzmark{3}{$\lambda h$}\ \ \tikzmark{4}{$\lambda z$}\ \ \tikzmark{5}{$@_4$}\ \ \tikzmark{6}{$@_1$}\ \ \tikzmark{7}{$h$}\ \ \tikzmark{8}{$\lambda f$}\ \ \tikzmark{9}{$\lambda y$}\ \ \tikzmark{10}{$@_{7}$}\ \ \tikzmark{11}{$f$}\ \ \tikzmark{12}{$\lambda x$}\ \ \tikzmark{13}{$@_3$}\ \ \tikzmark{14}{$@_2$}\ \ \tikzmark{15}{$h$}\ \ \tikzmark{16}{$\lambda f$}\ \ \tikzmark{17}{$\lambda y$}\ \ \tikzmark{18}{$@_7$}\ \ \tikzmark{19}{$f$}\ \ \tikzmark{20}{$\lambda q$}\ \ \tikzmark{21}{$x$}\ \ \tikzmark{22}{$@_9$}\ \ \tikzmark{23}{$@_8$}\ \ \color{blue}{\tikzmark{24}{$g$}} \ \ {\color{violet}{\tikzmark{25}{$\lambda b$}}}\ \ \color{blue}{\tikzmark{26}{$b$}}\ \ \color{black}{\tikzmark{27}{$y$}}\ \ \tikzmark{28}{$@_5$}\ \ \tikzmark{29}{$z$}\ \ \tikzmark{30}{$@_{11}$}\ \ \color{blue}{\tikzmark{31}{$g$}}\ \ {\color{violet}{\tikzmark{32}{$\lambda n$}}}\ \ \color{blue}{\tikzmark{33}{$n$}\ \ \tikzmark{34}{$a$}}\]
\begin{tikzpicture}[remember picture,overlay]
  \color{red}{\draw[->] (2.north) to[bend right] (1.north);}
  \color{blue}{\draw[->] (2.south west) to[bend left] (1.south east);}
  \color{green}{\draw[->] (2.south) to[bend left] (1.south);}
  \color{red}{\draw[->] (3.north) to[bend right] (2.north);}
  \color{blue}{\draw[->] (3.south west) to[bend left] (2.south east);}
  \color{green}{\draw[->] (3.south) to[bend left] (2.south);}
  \color{red}{\draw[->] (4.north) to[bend right] (1.north);}
  \color{blue}{\draw[->] (4.south west) to[bend left] (1.south east);}
  \color{green}{\draw[->] (4.south) to[bend left] (3.south);}
  \color{green}{\draw[->] (5.south) to[bend left] (4.south);}
  \color{red}{\draw[->] (6.north) to[bend right] (5.north);}
  \color{blue}{\draw[->] (6.south west) to[bend left] (5.south east);}
  \color{green}{\draw[->] (6.south) to[bend left] (5.south);}
  \color{red}{\draw[->] (7.north) to[bend right] (6.north);}
  \color{blue}{\draw[->] (7.south west) to[bend left] (6.south east);}
  \color{green}{\draw[->] (7.south) to[bend left] (3.south);}
  \color{red}{\draw[->] (8.north) to[bend right] (6.north);}
  \color{blue}{\draw[->] (8.south west) to[bend left] (6.south east);}
  \color{green}{\draw[->] (8.south) to[bend left] (2.south);}
  \color{red}{\draw[->] (9.north) to[bend right] (5.north);}
  \color{blue}{\draw[->] (9.south west) to[bend left] (5.south east);}
  \color{green}{\draw[->] (9.south) to[bend left] (8.south);}
  \color{green}{\draw[->] (10.south) to[bend left] (9.south);}
  \color{red}{\draw[->] (11.north) to[bend right] (10.north);}
  \color{blue}{\draw[->] (11.south west) to[bend left] (10.south east);}
  \color{green}{\draw[->] (11.south) to[bend left] (8.south);}
  \color{red}{\draw[->] (12.north) to[bend right] (10.north);}
  \color{blue}{\draw[->] (12.south west) to[bend left] (10.south east);}
  \color{green}{\draw[->] (12.south) to[bend left] (6.south);}
  \color{green}{\draw[->] (13.south) to[bend left] (12.south);}
  \color{red}{\draw[->] (14.north) to[bend right] (13.north);}
  \color{blue}{\draw[->] (14.south west) to[bend left] (13.south east);}
  \color{green}{\draw[->] (14.south) to[bend left] (13.south);}
  \color{red}{\draw[->] (15.north) to[bend right] (14.north);}
  \color{blue}{\draw[->] (15.south west) to[bend left] (14.south east);}
  \color{green}{\draw[->] (15.south) to[bend left] (3.south);}
  \color{red}{\draw[->] (16.north) to[bend right] (14.north);}
  \color{blue}{\draw[->] (16.south west) to[bend left] (14.south east);}
  \color{green}{\draw[->] (16.south) to[bend left] (2.south);}
  \color{red}{\draw[->] (17.north) to[bend right] (13.north);}
  \color{blue}{\draw[->] (17.south west) to[bend left] (13.south east);}
  \color{green}{\draw[->] (17.south) to[bend left] (16.south);}
  \color{green}{\draw[->] (18.south) to[bend left] (17.south);}
  \color{red}{\draw[->] (19.north) to[bend right] (18.north);}
  \color{blue}{\draw[->] (19.south west) to[bend left] (18.south east);}
  \color{green}{\draw[->] (19.south) to[bend left] (16.south);}
  \color{red}{\draw[->] (20.north) to[bend right] (18.north);}
  \color{blue}{\draw[->] (20.south west) to[bend left] (18.south east);}
  \color{green}{\draw[->] (20.south) to[bend left] (14.south);}
  \color{green}{\draw[->] (21.south) to[bend left] (12.south);}
  \color{green}{\draw[->] (22.south) to[bend left] (10.south);}
  \color{red}{\draw[->] (23.north) to[bend right] (22.north);}
  \color{blue}{\draw[->] (23.south west) to[bend left] (22.south east);}
  \color{green}{\draw[->] (23.south) to[bend left] (22.south);}
  \color{red}{\draw[->] (24.north) to[bend right] (23.north);}
  \color{blue}{\draw[->] (24.south west) to[bend left] (23.south east);}
  \color{red}{\draw[->] (25.north) to[bend right] (23.north);}
  \color{blue}{\draw[->] (25.south west) to[bend left] (20.south east);}
  \color{green}{\draw[->] (25.south) to[bend left] (23.south);}
  \color{red}{\draw[->] (26.north) to[bend right] (22.north);}
  \color{blue}{\draw[->] (26.south west) to[bend left] (22.south east);}
  \color{green}{\draw[->] (26.south) to[bend left] (25.south);}
  \color{green}{\draw[->] (27.south) to[bend left] (9.south);}
  \color{green}{\draw[->] (28.south) to[bend left] (5.south);}
  \color{red}{\draw[->] (29.north) to[bend right] (28.north);}
  \color{blue}{\draw[->] (29.south west) to[bend left] (28.south east);}
  \color{green}{\draw[->] (29.south) to[bend left] (4.south);}
  \color{red}{\draw[->] (30.north) to[bend right] (28.north);}
  \color{blue}{\draw[->] (30.south west) to[bend left] (28.south east);}
  \color{green}{\draw[->] (30.south) to[bend left] (1.south);}
  \color{red}{\draw[->] (31.north) to[bend right] (30.north);}
  \color{blue}{\draw[->] (31.south west) to[bend left] (30.south east);}
  \color{red}{\draw[->] (32.north) to[bend right] (30.north);}
  \color{green}{\draw[->] (32.south) to[bend left] (30.south);}
  \color{red}{\draw[->] (33.north) to[bend right] (28.north);}
  \color{blue}{\draw[->] (33.south west) to[bend left] (28.south east);}
  \color{green}{\draw[->] (33.south) to[bend left] (32.south);}
\end{tikzpicture}
\end{landscape}















\section{TODO}
\begin{enumerate}
\item proof correctness and residual term (normalized) reconstruction
\end{enumerate}

\end{document}








